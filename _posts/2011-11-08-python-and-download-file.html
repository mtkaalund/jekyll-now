---
layout: post
title: python and download an file
date: '2011-11-08T11:14:00.000-08:00'
author: MTKaalund
tags:
- urllib2
- python
- file
- download
modified_time: '2011-11-11T06:36:07.008-08:00'
thumbnail: http://1.bp.blogspot.com/-ZPVabrDFGrM/TrlvorY2KqI/AAAAAAAAHqA/0vaxkh9ixZs/s72-c/python.com.html.png
blogger_id: tag:blogger.com,1999:blog-2855698641636925797.post-6006256193546263586
blogger_orig_url: http://www.mtkaalund.dk/2011/11/python-and-download-file.html
---

So when you are programming/scripting in python, there comes a time when you want do get python to download a file.<br />This is more or less really good documented on the web, not really from the official python documentation. <br />So there is two libraries to designed to handle web request (and there is at least one to handle <i>socket</i> request). So the two libraries handle is called <i>urllib</i> and <i>urllib2</i>, the one I would suggest at least for web downloads of and file or a web page.<br />So to make an simple start:<br /><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">import urllib2</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">url = "http://www.python.com" </span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">request = urllib2.Request(url)</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">urlobj = urllib2.urlopen(request)</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">readpage = urlobj.read()</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">print readpage</span></blockquote>So first we import the <i>urllib2</i> library into python... yeah I know that you properly know this, but humor me.<br />The next I have defined url that I would like to download this is <a href="http://www.python.com/"><i>http://www.python.com</i></a>, why I wanted to download this web page is to show it is possible.<br />So make an request for this url (<i>urllib2.Request</i>), and after that we going to make an url object with <i>urllib2.urlopen</i>. When it is done, we can read the web page with <i>urllib2.read</i> and we are going to print it out in the terminal.<br />So this is fine if we wanted to just print it out to the terminal, but what if we want to write this to a file. So we are going to create an new script, which have almost the same:<br /><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">import urllib2</span></blockquote><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">import shutil</span> </blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">url = "http://www.python.com"</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">fname = "python.com.html" </span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">request = urllib2.Request(url)</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">urlobj = urllib2.urlopen(request) </span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">&nbsp;try:</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">with open(fname, 'wb') as f:</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">shutil.copyfileobj(urlobj, f)</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">finally:</span></blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">urlobj.close()</span><span style="font-family: 'Courier New', Courier, monospace;"> </span></blockquote></blockquote><br />And when we open this file in an editor, like <b>gedit</b> we see something like:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ZPVabrDFGrM/TrlvorY2KqI/AAAAAAAAHqA/0vaxkh9ixZs/s1600/python.com.html.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="210" src="http://1.bp.blogspot.com/-ZPVabrDFGrM/TrlvorY2KqI/AAAAAAAAHqA/0vaxkh9ixZs/s640/python.com.html.png" width="640" /></a></div>So, we open our local file "<i>python.com.html</i>" using the python <i>open</i> function using the '<i>wb</i>' statement, so the '<i>w</i>' is writeable, and the '<i>b</i>' is binary mode. To read more on the built-in <i>open</i> function see reference no.1, and we are using the with statement to open it our local file, I'm not going into depth on the with statement, but <a href="http://www.effbot.org/" target="_blank">effbot.org </a>has already done this, see reference no.2 to read up on it.<br /><br /><b>Creating a class to handle our download</b><br />okay, now our code works to download a file, but if we are going to download more than one file, it can be useful to put it in an function, or make an class that can handle all the downloads.<br />If you are writing on an bigger script, where you need to download more than one file. So if you need to read up on python classes see reference no. 3. Create a file called "<i>DownloadFile.py</i>" and here is the code: <br /><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">from urllib2 import Request, urlopen, URLError, HTTPError</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">from shutil import </span><span style="font-size: x-small;">copyfileobj</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">from os.path import isfile, exists</span></blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">class DownloadFile:</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">def __init__(self, url, tofile):</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">self.link = url </span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">self.filename = tofile</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">self.urlobj = None</span></blockquote></blockquote></blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">def __connect(self):</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">returncode = True</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">try:</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">request = Request(self.link) </span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">self.urlobj = urlopen(request)</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">except URLError, e:</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">&nbsp;# There probably need some code, to </span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">&nbsp;# handle&nbsp; error code</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">returncode = False</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">except HTTPError, e:</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;"># There probably need some code, to </span></blockquote></blockquote></blockquote></blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"></div><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;"># handle&nbsp; error code</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">returncode = False</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">return returncode</span></blockquote></blockquote></blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">def __write(self):</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">try:</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">with open(self.filename, 'wb') as f:</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">copyfileobj(self.urlobj, f)</span></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">finally:</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">self.urlobj.close()</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">def run(self):</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">if not exists(self.filename) and not isfile(self.filename): </span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">gets = self.__connect()</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">if gets:</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">self.__write()</span></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">return "Downloaded"</span></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">else:</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">return "Failed"</span></blockquote></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">else:</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">return "Exists"</span></blockquote></blockquote></blockquote></blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><br /></div><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">def info(self):</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">if self.fileobj is None:</span></blockquote></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;">self.__connect()</span></blockquote></blockquote></blockquote></blockquote><blockquote class="tr_bq"><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">return self.urlobj.info()</span></span></blockquote></blockquote></blockquote><br /><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">if __name__ == "__main__":</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">url = "http://meganfoxfans.net/wp-content/uploads/2011/10/Megan_Fox_Picture-coffee.jpg"</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">lname = "Megan_Fox_Walking_with_Coffee.jpg"</span></blockquote></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><blockquote class="tr_bq"><span style="font-size: x-small;">print "Will try to download a picture of Megan Fox:",</span></blockquote></blockquote><blockquote class="tr_bq"><blockquote class="tr_bq"><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">print DownloadFile(url,lname).run() </span></span></blockquote></blockquote>To run it just do like this:<br /><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">python /path_to_file/DownloadFile.py</span></blockquote>It will return something like<br /><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">"Will try to download a picture of Mega Fox: Downloaded"</span></blockquote><br />That is it for now, hope it can be useful for somebody :D And if you can use it, and you meet me someday, just remember to buy me a beer ;)<br /><br /><br /><b>Reference:</b><br /><blockquote class="tr_bq">[1] <a href="http://docs.python.org/library/functions.html#open" target="_blank">Python open function</a></blockquote><blockquote class="tr_bq">[2] <a href="http://effbot.org/zone/python-with-statement.htm" target="_blank">Python with statement</a> </blockquote><blockquote class="tr_bq">[3] <a href="http://docs.python.org/tutorial/classes.html" target="_blank">Python classes</a> </blockquote>
---
layout: post
title: XBMC and packaging
date: '2011-11-07T16:51:00.000-08:00'
author: MTKaalund
tags:
- xbmc
- linux
- bash
- packaging
modified_time: '2011-11-14T04:32:42.549-08:00'
blogger_id: tag:blogger.com,1999:blog-2855698641636925797.post-230259423428535258
blogger_orig_url: http://www.mtkaalund.dk/2011/11/xbmc-and-packaging.html
---

So I've got this media centre, which is in reality just an "old" Intel motherboard, with an Intel Atom processor and 2 GB ram.<br />About two weeks ago, I reinstalled XBMC&nbsp; on it, at first I was running an gentoo with XBMC installed on top. I really liked it, because it was an minimal installation, but with me an gentoo which I always fuck it up. But that's life, always updating the system when I don't have the time to take care of it.<br /><br />So this time I installed the live cd provided&nbsp; from the xbmc-live team, nice and easy to run and install. But this is not the neweste version of the xbmc media centre, but again xbmc, has a packaging team, I must say that I think that they have done a fine job of making the scripts user friendly.<br />But there is not any instructions on how getting started with these scripts or how to setting an build environment up.<br /><br />So there is many ways to setting the build environment up, but as far I can see there is two methods to do this. The first method is to create an new user, which handles all the building of the xbmc packaging, the other way is to use your xbmc user to build and package the files.<br /><br />I always ssh into my media centre, so I will assume, if you want to follow this, that you also do this.<br /><br /><b>So here is the first way to do this:</b><br /><br />This way we create an new user, you can call it what you want, but I have called it "buildd". So when you have login in to your xbmc media centre.<br /><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">xbmc@XBMCLive</span><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;"> ~: sudo adduser buildd</span></span></blockquote>Just enter all the informations that it will ask about<span style="font-family: 'Courier New', Courier, monospace;">.</span> This will create an user home directory in "<b>/home</b>", this will become our build environment.<br />The next we want to do is give our new user superuser access, so as I just assumes that we are on an debian system (like the xbmc live cd is), so now we are going to modify sudoers.<br /><blockquote class="tr_bq"><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">xbmc@XBMCLive ~: sudo visudo</span></div></blockquote>In that file, you have to be careful on what you are doing, because it can remove your user from the sudo list, which is not good. But just add this at the end of the file:<br /><blockquote class="tr_bq" style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">## lines to be added in order to build XBMC<br />buildd ALL=NOPASSWD: ALL</blockquote>(be aware that this command is not secure, <b>it will grant root access for anybody</b> that is login as buildd)<br />After this we are going login as the new user:<br /><blockquote class="tr_bq"><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">xbmc@XBMCLive ~: su buildd &amp;&amp; cd</span></span> </blockquote>and do the rest from the new user. The next thing we need to do is setup an GPG key, for signing the packages that we compiles and build.<br /><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">buildd@XBMCLive ~: </span>gpg --cert-digest-algo=SHA256 --default-preference-list="h10 h8 h9 h11 s9 s8 s7 s3 z2 z3 z1 z0" --gen-key</span></blockquote>And this is how I done it, you can self take an look at <a href="https://help.ubuntu.com/community/GnuPrivacyGuardHowto" target="_blank">Ubuntu community GnuPrivacyGuardHowto</a><br /><ul><li>Select it the one that is <b>"RSA (sign only)"</b></li><li>The default key size should be <b>2048</b> if not the choose <b>2048</b></li><li>Then enter your name, e-mail, comments according to the <b>buildd</b> user</li><li>And I have not entered an password</li></ul>So right about now it could be useful to install <b>git</b> and <b>pbuilder</b>, as of we are going to use them in the next section.<br /><blockquote class="tr_bq"><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">buildd@XBMCLive ~: sudo apt-get update &amp;&amp; sudo apt-get install git-core pbuilder</span></span></blockquote>When done installing, we want setup some directories for our build environment<br /><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">buildd@XBMCLive ~: mkdir -vp {tmp,pbuilder/{aptcache,build,result}}</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">buildd@XBMCLive ~: sudo rm -rf /var/cache/pbuilder</span></blockquote><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">buildd@XBMCLive ~: sudo ln -s /home/buildd/pbuilder /var/cache/pbuilder</span></blockquote><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">buildd@XBMCLive ~: sudo ln -s /home/buildd/tmp /tmp/buildd </span></blockquote><br />An now, the build environment is done, then we want to clone the xbmc/xbmc-packaging repository<br /><blockquote class="tr_bq" style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: x-small;">buildd@XBMCLive ~: git clone git://github.com/xbmc/xbmc-packaging.git</span></blockquote><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">buildd@XBMCLive ~: cd xbmc-packaging</span></blockquote>Now before we can compile xbmc, we need the source for it. You can setup your own clone repository for xbmc, but there is an script that can handle that for us, so that is we want to do. This script can get the stable source or the development (unstable) source code, by setting the variable "<b>--stable</b>" after the script. To get the <b>development version:</b><br /><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">buildd@XBMCLive ~/</span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">xbmc-packaging</span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">: ./xbmc-get-orig-source</span></blockquote><b>stable version:</b><br /><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">buildd@XBMCLive ~/</span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">xbmc-packaging</span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">: ./xbmc-get-orig-source --stable</span></blockquote><b>pbuilder</b> calls its compressed build environment for images, so lets us create an image. As of writing the newest version of ubuntu is not supported (oneiric), but the it is fortune that XBMC live is lucid, and that is what we are going to make packages for. The <i>xbmc-packaging</i> repository provides us with an script that handle all the <b>pbuilder</b> commands and etc. So to first we need to create and build image for <b>pbuilder</b>.<br /><blockquote class="tr_bq"><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">buildd@XBMCLive ~/</span></span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">xbmc-packaging</span><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">: ./pbuilder-dist lucid create</span></span></blockquote>This creates the "build environment" for us, and it is going take some time to do it. It will create an chroot environment, which is an nice way to say that is going to download a lot of packages. If you want to know more about chroot environments, you can search <a href="https://www.google.com/search?client=ubuntu&amp;channel=fs&amp;q=chroot+environment&amp;ie=utf-8&amp;oe=utf-8" target="_blank">google</a>, or take a look at the <a href="https://help.ubuntu.com/community/BasicChroot" target="_blank">ubuntu documentations</a>.<br />When it is done with downloading the packages an compressed the image, we now can begin to build our first package (first make sure the there is an <b>*.dsc</b> file in the directory) <br /><blockquote class="tr_bq"><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">buildd@XBMCLive ~/</span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">xbmc-packaging</span><span style="font-family: 'Courier New', Courier, monospace; font-size: x-small;">: ./pbuilder-dist lucid build xbmc-11.0.dsc</span></blockquote>Now this is also going to take some time, so watch some tv, drink some coffee, the, beer or cola pick your poison. Now when the script is done, the resulting package should be in the "<i>/home/buildd/pbuilder/results/</i>" directory.<br />This package you should be able to install using the dpkg, with the install switch.<br /><blockquote class="tr_bq"><span style="font-size: x-small;"><span style="font-family: 'Courier New', Courier, monospace;">buildd@XBMCLive ~/pbuilder/results: sudo dpkg -i *.deb</span></span></blockquote>And it now you should have the newest compiled package installed. But now you are thinking about setting up your own ubuntu repository, and this will not be coveret at this time.<br />The next time, I will show you how do the same but without create an new user.<br /><br /><b>Reference:</b><br /><blockquote class="tr_bq"><a href="http://forum.xbmc.org/archive/index.php/t-60967.html" target="_blank">http://forum.xbmc.org/archive/index.php/t-60967.html</a></blockquote><blockquote class="tr_bq"><a href="https://github.com/xbmc/xbmc-packaging" target="_blank">https://github.com/xbmc/xbmc-packaging</a></blockquote><blockquote class="tr_bq"></blockquote><br />